<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workspace ‚Äì Advance Spreadsheet Assistance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* ‚îÄ‚îÄ MASTER THEME VARIABLES ‚îÄ‚îÄ */
    :root {
      --primary-blue: #4169E1;
      --primary-dark: #3457C4;
      --accent-green: #10B981;
      --accent-purple: #8B5CF6;
      --bg-light: #F8FAFC;
      --bg-white: #FFFFFF;
      --text-dark: #1F2937;
      --text-gray: #6B7280;
      --border-light: #E5E7EB;
      --sidebar-width: 220px;
      --toolbar-height: 60px;
      --chat-width: 320px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      height: 100vh;
      overflow: hidden;
      display: flex;
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInLeft {
      from { opacity: 0; transform: translateX(-16px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(160deg, #4169E1 0%, #7B68EE 100%);
      display: flex;
      flex-direction: column;
      height: 100vh;
      flex-shrink: 0;
      z-index: 10;
      box-shadow: 4px 0 24px rgba(65,105,225,0.18);
    }

    .sidebar-logo {
      padding: 28px 22px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }

    .logo-icon {
      width: 42px;
      height: 42px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .logo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      width: 28px;
      height: 28px;
    }

    .logo-grid-header {
      grid-column: 1/-1;
      background: linear-gradient(135deg, #10B981, #059669);
      border-radius: 3px 3px 0 0;
      height: 7px;
    }

    .logo-grid-cell {
      background: #E5E7EB;
      border-radius: 1px;
    }

    .sidebar-logo h2 {
      font-size: 15px;
      font-weight: 800;
      color: white;
      line-height: 1.3;
    }

    .sidebar-logo span {
      font-size: 12px;
      font-weight: 500;
      color: rgba(255,255,255,0.75);
    }

    .sidebar-nav {
      flex: 1;
      padding: 20px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-label {
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.5);
      padding: 0 10px;
      margin: 10px 0 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 14px;
      border-radius: 12px;
      color: rgba(255,255,255,0.82);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      animation: fadeInLeft 0.5s ease-out both;
    }

    .nav-item:nth-child(1) { animation-delay: 0.1s; }
    .nav-item:nth-child(2) { animation-delay: 0.2s; }
    .nav-item:nth-child(3) { animation-delay: 0.3s; }
    .nav-item:nth-child(4) { animation-delay: 0.4s; }

    .nav-item:hover {
      background: rgba(255,255,255,0.15);
      color: white;
      transform: translateX(3px);
    }

    .nav-item.active {
      background: rgba(255,255,255,0.22);
      color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-item .nav-icon {
      width: 32px;
      height: 32px;
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      backdrop-filter: blur(10px);
    }

    .nav-item.active .nav-icon {
      background: rgba(255,255,255,0.3);
    }

    .nav-item svg {
      width: 16px;
      height: 16px;
    }

    .sidebar-footer {
      padding: 16px 12px;
      border-top: 1px solid rgba(255,255,255,0.15);
    }

    .logout-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 14px;
      border-radius: 12px;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      background: none;
      border: none;
      font-family: 'Outfit', sans-serif;
      width: 100%;
    }

    .logout-btn:hover {
      background: rgba(255,100,100,0.2);
      color: #FCA5A5;
    }

    /* ‚îÄ‚îÄ MAIN AREA ‚îÄ‚îÄ */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ TOOLBAR ‚îÄ‚îÄ */
    .toolbar {
      height: var(--toolbar-height);
      background: var(--bg-white);
      border-bottom: 1.5px solid var(--border-light);
      display: flex;
      align-items: center;
      padding: 0 24px;
      gap: 10px;
      flex-shrink: 0;
      animation: slideUp 0.5s ease-out 0.1s both;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }

    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .toolbar-center {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      justify-content: center;
    }

    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      justify-content: flex-end;
    }

    .file-name {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-dark);
    }

    .file-badge {
      background: rgba(65,105,225,0.1);
      color: var(--primary-blue);
      font-size: 11px;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 20px;
      letter-spacing: 0.3px;
    }

    .toolbar-divider {
      width: 1px;
      height: 24px;
      background: var(--border-light);
    }

    .tool-btn {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 700;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .tool-btn svg {
      width: 15px;
      height: 15px;
    }

    .tool-btn.primary {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
      color: white;
      box-shadow: 0 3px 10px rgba(65,105,225,0.3);
    }

    .tool-btn.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 16px rgba(65,105,225,0.4);
    }

    .tool-btn.secondary {
      background: var(--bg-light);
      color: var(--text-dark);
      border: 1.5px solid var(--border-light);
    }

    .tool-btn.secondary:hover {
      background: white;
      border-color: var(--primary-blue);
      color: var(--primary-blue);
    }

    .tool-btn.green {
      background: linear-gradient(135deg, #10B981, #059669);
      color: white;
      box-shadow: 0 3px 10px rgba(16,185,129,0.3);
    }

    .tool-btn.green:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 16px rgba(16,185,129,0.4);
    }

    /* ‚îÄ‚îÄ CONTENT AREA ‚îÄ‚îÄ */
    .content {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ SPREADSHEET AREA ‚îÄ‚îÄ */
    .spreadsheet-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg-white);
      border-right: 1.5px solid var(--border-light);
      animation: slideUp 0.5s ease-out 0.2s both;
    }

    /* Formula bar */
    .formula-bar {
      height: 38px;
      display: flex;
      align-items: center;
      border-bottom: 1.5px solid var(--border-light);
      padding: 0 12px;
      gap: 10px;
      background: #FAFBFC;
      flex-shrink: 0;
    }

    .cell-ref {
      width: 72px;
      background: white;
      border: 1.5px solid var(--border-light);
      border-radius: 7px;
      padding: 4px 10px;
      font-size: 13px;
      font-weight: 700;
      font-family: 'Outfit', sans-serif;
      color: var(--primary-blue);
      text-align: center;
      flex-shrink: 0;
    }

    .formula-fx {
      font-size: 13px;
      font-weight: 800;
      color: var(--accent-purple);
      flex-shrink: 0;
    }

    .formula-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 13px;
      font-family: 'Outfit', sans-serif;
      color: var(--text-dark);
      background: transparent;
    }

    /* Spreadsheet Grid */
    .sheet-wrapper {
      flex: 1;
      overflow: auto;
      position: relative;
    }

    .sheet-table {
      border-collapse: collapse;
      min-width: 100%;
      font-size: 13px;
    }

    .sheet-table th {
      position: sticky;
      top: 0;
      background: #F3F4F6;
      border: 1px solid var(--border-light);
      padding: 5px 0;
      text-align: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-gray);
      min-width: 90px;
      z-index: 2;
      letter-spacing: 0.5px;
    }

    .sheet-table th.row-header {
      min-width: 44px;
      width: 44px;
      position: sticky;
      left: 0;
      z-index: 3;
    }

    .sheet-table td {
      border: 1px solid var(--border-light);
      padding: 0;
      height: 28px;
      min-width: 90px;
    }

    .sheet-table td.row-num {
      background: #F3F4F6;
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-gray);
      position: sticky;
      left: 0;
      z-index: 1;
      width: 44px;
      min-width: 44px;
      cursor: default;
    }

    .sheet-table td input {
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      padding: 0 8px;
      font-size: 13px;
      font-family: 'Outfit', sans-serif;
      color: var(--text-dark);
      background: transparent;
    }

    .sheet-table td input:focus {
      background: #EEF2FF;
      box-shadow: inset 0 0 0 2px var(--primary-blue);
    }

    .sheet-table tbody tr:hover td:not(.row-num) {
      background: #F5F7FF;
    }

    .sheet-table thead th.selected,
    .sheet-table td.selected {
      background: #EEF2FF !important;
    }

    /* Sample data styling */
    .cell-header {
      background: linear-gradient(135deg, rgba(65,105,225,0.08), rgba(139,92,246,0.08)) !important;
    }

    .cell-header input {
      font-weight: 700 !important;
      color: var(--primary-blue) !important;
    }

    .cell-green input { color: #059669 !important; font-weight: 600 !important; }
    .cell-red input { color: #EF4444 !important; font-weight: 600 !important; }

    /* Sheet tabs */
    .sheet-tabs {
      height: 36px;
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 4px;
      border-top: 1.5px solid var(--border-light);
      background: #F8FAFC;
      flex-shrink: 0;
    }

    .sheet-tab {
      padding: 5px 16px;
      border-radius: 8px 8px 0 0;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1.5px solid transparent;
    }

    .sheet-tab.active {
      background: white;
      color: var(--primary-blue);
      border-color: var(--border-light);
      border-bottom-color: white;
    }

    .sheet-tab:not(.active) {
      color: var(--text-gray);
    }

    .sheet-tab:not(.active):hover {
      background: rgba(65,105,225,0.06);
      color: var(--primary-blue);
    }

    .tab-add {
      width: 26px;
      height: 26px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-gray);
      cursor: pointer;
      font-size: 18px;
      font-weight: 400;
      transition: all 0.2s ease;
    }

    .tab-add:hover {
      background: rgba(65,105,225,0.1);
      color: var(--primary-blue);
    }

    /* ‚îÄ‚îÄ AI CHAT PANEL ‚îÄ‚îÄ */
    .chat-panel {
      width: var(--chat-width);
      background: var(--bg-white);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      animation: slideInRight 0.5s ease-out 0.3s both;
    }

    .chat-header {
      padding: 16px 18px 14px;
      border-bottom: 1.5px solid var(--border-light);
      background: var(--bg-white);
      flex-shrink: 0;
    }

    .chat-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .ai-avatar {
      width: 34px;
      height: 34px;
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 3px 10px rgba(65,105,225,0.3);
    }

    .ai-avatar svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    .chat-title-text h3 {
      font-size: 15px;
      font-weight: 800;
      color: var(--text-dark);
    }

    .ai-status {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      color: #10B981;
      font-weight: 600;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      background: #10B981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(0.85); }
    }

    .chat-subtitle {
      font-size: 12px;
      color: var(--text-gray);
    }

    /* Suggested prompts */
    .chat-suggestions {
      padding: 10px 14px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      border-bottom: 1.5px solid var(--border-light);
      background: #FAFBFC;
      flex-shrink: 0;
    }

    .suggestion-chip {
      padding: 5px 12px;
      background: rgba(65,105,225,0.07);
      border: 1.5px solid rgba(65,105,225,0.15);
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      color: var(--primary-blue);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .suggestion-chip:hover {
      background: rgba(65,105,225,0.14);
      border-color: var(--primary-blue);
    }

    /* Chat messages */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      scroll-behavior: smooth;
    }

    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track { background: transparent; }
    .chat-messages::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 4px; }

    .msg {
      display: flex;
      gap: 9px;
      animation: slideUp 0.3s ease-out;
    }

    .msg.user { flex-direction: row-reverse; }

    .msg-avatar {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
      flex-shrink: 0;
    }

    .msg.ai .msg-avatar {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
      color: white;
    }

    .msg.user .msg-avatar {
      background: #F3F4F6;
      color: var(--text-gray);
    }

    .msg-bubble {
      max-width: 78%;
      padding: 10px 13px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.6;
    }

    .msg.ai .msg-bubble {
      background: var(--bg-light);
      color: var(--text-dark);
      border: 1.5px solid var(--border-light);
      border-top-left-radius: 4px;
    }

    .msg.user .msg-bubble {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
      color: white;
      border-top-right-radius: 4px;
    }

    .msg-time {
      font-size: 10px;
      color: var(--text-gray);
      margin-top: 4px;
      opacity: 0.7;
    }

    .msg.user .msg-time { text-align: right; }

    /* Typing indicator */
    .typing-indicator {
      display: none;
      gap: 9px;
    }

    .typing-indicator.active { display: flex; }

    .typing-dots {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 12px 14px;
      background: var(--bg-light);
      border: 1.5px solid var(--border-light);
      border-radius: 14px;
      border-top-left-radius: 4px;
    }

    .typing-dots span {
      width: 7px;
      height: 7px;
      background: var(--text-gray);
      border-radius: 50%;
      animation: typingBounce 1.2s infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: translateY(0); opacity: 0.5; }
      40% { transform: translateY(-6px); opacity: 1; }
    }

    /* Chat input */
    .chat-input-area {
      padding: 12px 14px;
      border-top: 1.5px solid var(--border-light);
      background: var(--bg-white);
      flex-shrink: 0;
    }

    .chat-input-box {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: 14px;
      padding: 8px 10px 8px 14px;
      transition: all 0.2s ease;
    }

    .chat-input-box:focus-within {
      border-color: var(--primary-blue);
      background: white;
      box-shadow: 0 0 0 4px rgba(65,105,225,0.1);
    }

    .chat-input-box textarea {
      flex: 1;
      border: none;
      outline: none;
      resize: none;
      font-size: 13px;
      font-family: 'Outfit', sans-serif;
      color: var(--text-dark);
      background: transparent;
      max-height: 80px;
      line-height: 1.5;
    }

    .chat-input-box textarea::placeholder { color: #9CA3AF; }

    .send-btn {
      width: 34px;
      height: 34px;
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(65,105,225,0.3);
    }

    .send-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 4px 14px rgba(65,105,225,0.4);
    }

    .send-btn:active { transform: scale(0.96); }

    .send-btn svg {
      width: 16px;
      height: 16px;
      fill: white;
    }

    .chat-hint {
      font-size: 11px;
      color: var(--text-gray);
      margin-top: 7px;
      text-align: center;
    }

    /* ‚îÄ‚îÄ SCROLLBAR GLOBAL ‚îÄ‚îÄ */
    .sheet-wrapper::-webkit-scrollbar { width: 8px; height: 8px; }
    .sheet-wrapper::-webkit-scrollbar-track { background: #F3F4F6; }
    .sheet-wrapper::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
    .sheet-wrapper::-webkit-scrollbar-thumb:hover { background: #9CA3AF; }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 968px) {
      .sidebar { display: none; }
      .chat-panel { width: 280px; }
    }

    @media (max-width: 640px) {
      .chat-panel { display: none; }
      :root { --chat-width: 0px; }
    }
  </style>
</head>
<body>

  <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <div class="logo-grid">
          <div class="logo-grid-header"></div>
          <div class="logo-grid-cell"></div>
          <div class="logo-grid-cell"></div>
          <div class="logo-grid-cell"></div>
          <div class="logo-grid-cell"></div>
          <div class="logo-grid-cell"></div>
          <div class="logo-grid-cell"></div>
        </div>
      </div>
      <h2>Advance Spreadsheet<br>Assistance</h2>
      <span>AI-powered automation</span>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-label">Menu</div>

      <a class="nav-item" onclick="goToDashboard()">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" fill="white"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
        </div>
        Dashboard
      </a>

      <a class="nav-item" onclick="uploadFile()">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" fill="white"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>
        </div>
        Upload
      </a>

      <a class="nav-item active">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" fill="white"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 2v2H4V6h16zM4 18v-8h16v8H4z"/></svg>
        </div>
        Workspace
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" onclick="handleLogout()">
        <div class="nav-icon" style="background:rgba(255,100,100,0.2);">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="rgba(255,255,255,0.8)"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
        </div>
        Logout
      </button>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
  <div class="main">

    <!-- TOOLBAR -->
    <div class="toolbar">
      <div class="toolbar-left">
        <span class="file-name">Sample_Data.xlsx</span>
        <span class="file-badge">Saved</span>
      </div>

      <div class="toolbar-center">
        <button class="tool-btn secondary" onclick="uploadFile()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>
          Upload
        </button>
        <button class="tool-btn green" onclick="downloadFile()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          Download
        </button>
        <div class="toolbar-divider"></div>
        <button class="tool-btn primary" onclick="goToDashboard()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
          Dashboard
        </button>
      </div>

      <div class="toolbar-right">
        <button class="tool-btn secondary" onclick="formatCells()">
          <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"/></svg>
          Format
        </button>
        <button class="tool-btn secondary" onclick="insertFormula()">
          <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
          Formula
        </button>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="content">

      <!-- SPREADSHEET AREA -->
      <div class="spreadsheet-area">

        <!-- Formula Bar -->
        <div class="formula-bar">
          <input class="cell-ref" id="cellRef" value="A1" readonly>
          <span class="formula-fx">∆íx</span>
          <input class="formula-input" id="formulaInput" placeholder="Enter value or formula...">
        </div>

        <!-- Handsontable Placeholder / Custom Grid -->
        <div class="sheet-wrapper" id="handsontable-container">
          <table class="sheet-table" id="spreadsheet">
            <thead>
              <tr>
                <th class="row-header"></th>
                <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th>
                <th>F</th><th>G</th><th>H</th><th>I</th><th>J</th>
              </tr>
            </thead>
            <tbody id="sheet-body"></tbody>
          </table>
        </div>

        <!-- Sheet Tabs -->
        <div class="sheet-tabs">
          <div class="sheet-tab active" onclick="switchSheet(this)">Sheet 1</div>
          <div class="sheet-tab" onclick="switchSheet(this)">Sheet 2</div>
          <div class="sheet-tab" onclick="switchSheet(this)">Sheet 3</div>
          <div class="tab-add" onclick="addSheet()">+</div>
        </div>
      </div>

      <!-- AI CHAT PANEL -->
      <div class="chat-panel">
        <div class="chat-header">
          <div class="chat-title">
            <div class="ai-avatar">
              <svg viewBox="0 0 24 24"><path d="M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zM7 9h10v8H7V9zm5 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm-2.5-3h1v-1h-1v1zm5 0h1v-1h-1v1z"/></svg>
            </div>
            <div class="chat-title-text">
              <h3>AI Assistant</h3>
              <div class="ai-status">
                <div class="status-dot"></div> Ready
              </div>
            </div>
          </div>
          <p class="chat-subtitle">Ask me anything about your spreadsheet</p>
        </div>

        <div class="chat-suggestions">
          <div class="suggestion-chip" onclick="sendSuggestion(this)">Summarize data</div>
          <div class="suggestion-chip" onclick="sendSuggestion(this)">Find duplicates</div>
          <div class="suggestion-chip" onclick="sendSuggestion(this)">Add SUM formula</div>
          <div class="suggestion-chip" onclick="sendSuggestion(this)">Clean formatting</div>
        </div>

        <div class="chat-messages" id="chatMessages">
          <div class="msg ai">
            <div class="msg-avatar">AI</div>
            <div>
              <div class="msg-bubble">üëã Hello! I'm your AI spreadsheet assistant. I can help you analyze data, write formulas, clean up formatting, and much more. What would you like to do?</div>
              <div class="msg-time">Just now</div>
            </div>
          </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
          <div class="msg-avatar msg-avatar" style="width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,#4169E1,#8B5CF6);color:white;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;">AI</div>
          <div class="typing-dots">
            <span></span><span></span><span></span>
          </div>
        </div>

        <div class="chat-input-area">
          <div class="chat-input-box">
            <textarea id="chatInput" placeholder="Ask about your data..." rows="1"
              onkeydown="handleChatKey(event)"
              oninput="autoResize(this)"></textarea>
            <button class="send-btn" onclick="sendMessage()">
              <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
          </div>
          <p class="chat-hint">Press Enter to send ¬∑ Shift+Enter for new line</p>
        </div>
      </div>
    </div>
  </div>
  <input type="file" id="fileInput" style="display:none" accept=".csv,.xlsx,.xls,.pdf" />

  <script>
    /* ‚îÄ‚îÄ‚îÄ CONFIGURATION ‚îÄ‚îÄ‚îÄ */
    const API = "http://127.0.0.1:8000";

    /* ‚îÄ‚îÄ‚îÄ 1. UPLOAD LOGIC ‚îÄ‚îÄ‚îÄ */
    // Trigger hidden input when clicking "Upload" button
    function uploadFile() {
        document.getElementById("fileInput").click();
    }

    // Handle file selection
    document.getElementById("fileInput").addEventListener("change", async function() {
        const file = this.files[0];
        if (!file) return;

        // Show loading toast
        addMessage(`Uploading ${file.name}...`, 'ai');

        const formData = new FormData();
        formData.append("file", file);

        try {
            const res = await fetch(`${API}/upload`, {
                method: "POST",
                body: formData
            });

            const data = await res.json();

            if (data.preview) {
                renderGrid(data.preview);
                addMessage(`Success! Loaded ${data.preview.length} rows from ${file.name}.`, 'ai');
            } else {
                addMessage("Error: " + (data.error || "Unknown error"), 'ai');
            }
        } catch (err) {
            console.error(err);
            addMessage("Connection Failed. Is the backend running?", 'ai');
        }
        
        // Reset input
        this.value = "";
    });

    /* ‚îÄ‚îÄ‚îÄ 2. GRID RENDERER ‚îÄ‚îÄ‚îÄ */
    function renderGrid(rows) {
        const tbody = document.getElementById("sheet-body");
        tbody.innerHTML = ""; // Clear existing dummy data

        if (rows.length === 0) return;

        // Create headers dynamically based on first row keys
        const headers = Object.keys(rows[0]);
        // Optional: Update TH elements here if you want dynamic headers
        
        rows.forEach((row, index) => {
            const tr = document.createElement("tr");
            
            // Row Number
            const tdNum = document.createElement("td");
            tdNum.className = 'row-num';
            tdNum.textContent = index + 1;
            tr.appendChild(tdNum);

            // Data Cells
            headers.forEach(key => {
                const td = document.createElement("td");
                const input = document.createElement("input");
                input.type = "text";
                input.value = row[key] || ""; // Handle null/undefined
                td.appendChild(input);
                tr.appendChild(td);
            });

            tbody.appendChild(tr);
        });
    }

    /* ‚îÄ‚îÄ‚îÄ 3. CHAT LOGIC ‚îÄ‚îÄ‚îÄ */
    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if (!text) return;

        // 1. Show User Message
        addMessage(text, 'user');
        input.value = '';

        // 2. Show Typing Indicator
        const typing = document.getElementById('typingIndicator');
        typing.classList.add('active');
        scrollChat();

        try {
            // 3. Send to Backend
            const res = await fetch(`${API}/analyze`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: text }) // FIXED: Was missing body
            });

            const data = await res.json();
            
            // 4. Remove Typing Indicator
            typing.classList.remove('active');

            // 5. Show AI Response
            if (data.insights) {
                // Join array of insights into a single string
                addMessage(data.insights.join("<br>"), 'ai');
            } else {
                addMessage(JSON.stringify(data), 'ai');
            }

        } catch (err) {
            typing.classList.remove('active');
            addMessage("Error connecting to AI Brain.", 'ai');
        }
    }

    /* ‚îÄ‚îÄ‚îÄ UI HELPERS ‚îÄ‚îÄ‚îÄ */
    function addMessage(text, type) {
        const msgs = document.getElementById('chatMessages');
        const msg = document.createElement('div');
        msg.className = `msg ${type}`;
        msg.innerHTML = `
            <div class="msg-avatar">${type === 'ai' ? 'AI' : 'You'}</div>
            <div><div class="msg-bubble">${text}</div></div>`;
        msgs.appendChild(msg);
        scrollChat();
    }

    function scrollChat() {
        const msgs = document.getElementById('chatMessages');
        msgs.scrollTop = msgs.scrollHeight;
    }

    function handleChatKey(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    }
    /* ‚îÄ‚îÄ‚îÄ ADD THIS FUNCTION FOR SUGGESTION CHIPS ‚îÄ‚îÄ‚îÄ */
    function sendSuggestion(element) {
        // 1. Get text from the chip
        const text = element.textContent.trim();
        
        // 2. Put it in the input box
        const input = document.getElementById('chatInput');
        input.value = text;
        
        // 3. Send the message automatically
        sendMessage();
    }
    /* ‚îÄ‚îÄ‚îÄ UPDATE THIS FUNCTION ‚îÄ‚îÄ‚îÄ */
    function downloadFile() {
        // Check if we have uploaded anything first (optional but good UI)
        const rows = document.querySelectorAll("#sheet-body tr");
        if (rows.length === 0) {
            addMessage("‚ö†Ô∏è Please upload a file first before downloading.", 'ai');
            return;
        }

        // Trigger the download
        window.location.href = "http://127.0.0.1:8000/download";
        
        addMessage("‚¨áÔ∏è Downloading updated CSV...", 'ai');
    }
    // Auto-load sample data on start
    window.onload = function() {
        console.log("UI Loaded. Waiting for file upload...");
    };
</script>
</body>
</html>
